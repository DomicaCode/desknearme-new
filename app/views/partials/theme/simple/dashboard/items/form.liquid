{% liquid
  assign currency = item.currency | default: default_currency
  if item.item_inventory_id
    assign path = 'create_version'
  else
    assign path = 'create'
  endif
  assign uuid = '' | uuid
  assign item_uuid = item.uuid | default: uuid
%}

<form action="/dashboard/items/{{ path }}" method="post" class="card" x-data="{ 'activeTab': 0 }" data-photo-upload-items>
  {% render 'authenticity_token', context: context %}

  {% if item.item_inventory_id %}
    <input type="hidden" name="item[item_inventory_id]" value="{{ item.item_inventory_id }}" />
  {% endif %}
  <input type="hidden" name="item[uuid]" value="{{ item_uuid }}" />
  <input type="hidden" name="item[currency]" value="{{ currency }}" />

  <ul class="-mx-4 mb-8 flex border-b-2 justify-center">
    {% for lang in lib.available_languages %}
      <li
        class="max-w-sm mb-[-2px] pt-2 pb-4 px-4 flex-grow border-b-2 cursor-pointer text-center uppercase transition-colors"
        :class="activeTab=={{ forloop.index0 }} ? 'text-interaction border-interaction font-semibold' : 'text-content-sidenote hover:text-content hover:border-interaction-disabled'"
        @click="activeTab = {{forloop.index0}}"
      >
        {{ 'languages.' | append: lang | t }}
        {% if item.details[lang].valid == false %}
          <span class="sidenote text-danger">
            ({{ 'app.items.form.invalid' | t }})
          </span>
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  <div class="flex flex-wrap gap-6 lg:gap-12">
    <div class="w-full md:w-auto flex-grow">

      {% for lang in lib.available_languages %}
        {% assign detail = item.details[lang] %}
        <input type="hidden" name="item[details][{{lang}}][lang]" value="{{lang}}">
        <div x-show="activeTab=={{forloop.index0}}">
          <fieldset>
            <label class="block" for="name_{{lang}}">{{ 'app.items.form.name' | t }}:</label>
            <input class="w-full" type="text" id="name_{{lang}}" name="item[details][{{lang}}][name]" value="{{ detail.name }}" autofocus>
            {% render 'theme/simple/field_error', errors: detail.errors.name %}
          </fieldset>

          <fieldset class="mt-6">
            <label class="block" for="description_{{lang}}">{{ 'app.items.form.description' | t }}:</label>
            <textarea class="w-full min-h-[319px]" type="text" id="description_{{lang}}" name="item[details][{{lang}}][description]" rows="12">{{ detail.description }}</textarea>

            {% render 'theme/simple/field_error', errors: detail.errors.description %}
          </fieldset>
        </div>
      {% endfor %}

    </div>

    <div class="lg:w-1/4">

      <fieldset>
        <label class="block" for="category">{{ 'app.items.form.category' | t }}:</label>
        <select class="w-full" id="category" name="item[category]">
          {% for category in lib.categories %}
            {% assign ident = category | split: '/' | size | minus: 1 | times: 2 %}
            <option value="{{ category }}" {% if item.category == category %}selected{% endif %}>
                {% for step in (1..ident) %} {% print "&nbsp;" %} {% endfor %}
                {{ 'categories.' | append: category | t }}
            </option>
          {% endfor %}
        </select>

        {% render 'theme/simple/field_error', errors: item.errors.category %}
      </fieldset>

      <fieldset class="mt-6">
        <label class="block" for="price_per_hour">{{ 'app.items.form.price_per_hour' | t }}:</label>
        <!-- TODO: Add currency prefix $[input]  -->
        <div class="flex items-center gap-3">
          <input class="w-3/4" type="number" id="price_per_hour" name="item[price_per_hour]" step="any" min="0" value="{{ item.price_per_hour | default: 1000 | fractional_to_amount: currency }}">
          {{ currency }}
        </div>
        {% render 'theme/simple/field_error', errors: item.errors.price_per_hour %}
      </fieldset>

      <fieldset class="mt-6">
        <label class="block" for="price_per_day">{{ 'app.items.form.price_per_day' | t }}:</label>
        <!-- TODO: Add currency prefix $[input]  -->
        <div class="flex items-center gap-3">
          <input class="w-3/4" type="number" id="price_per_day" name="item[price_per_day]" step="any" min="0" value="{{ item.price_per_day | default: 1000 | fractional_to_amount: currency }}">
          {{ currency }}
        </div>
        {% render 'theme/simple/field_error', errors: item.errors.price_per_day %}
      </fieldset>

      <fieldset class="mt-6">
        <label class="block" for="price_per_work_week">{{ 'app.items.form.price_per_work_week' | t }}:</label>
        <!-- TODO: Add currency prefix $[input]  -->
        <div class="flex items-center gap-3">
          <input class="w-3/4" type="number" id="price_per_work_week" name="item[price_per_work_week]" step="any" min="0" value="{{ item.price_per_work_week | default: 1000 | fractional_to_amount: currency }}">
          {{ currency }}
        </div>
        {% render 'theme/simple/field_error', errors: item.errors.price_per_work_week %}
      </fieldset>

      <fieldset class="mt-6">
        <label class="block" for="price_per_calendar_week">{{ 'app.items.form.price_per_calendar_week' | t }}:</label>
        <!-- TODO: Add currency prefix $[input]  -->
        <div class="flex items-center gap-3">
          <input class="w-3/4" type="number" id="price_per_calendar_week" name="item[price_per_calendar_week]" step="any" min="0" value="{{ item.price_per_calendar_week | default: 1000 | fractional_to_amount: currency }}">
          {{ currency }}
        </div>
        {% render 'theme/simple/field_error', errors: item.errors.price_per_calendar_week %}
      </fieldset>

      <fieldset class="mt-6">
        <label class="block" for="price_per_month">{{ 'app.items.form.price_per_month' | t }}:</label>
        <!-- TODO: Add currency prefix $[input]  -->
        <div class="flex items-center gap-3">
          <input class="w-3/4" type="number" id="price_per_month" name="item[price_per_month]" step="any" min="0" value="{{ item.price_per_month | default: 1000 | fractional_to_amount: currency }}">
          {{ currency }}
        </div>
        {% render 'theme/simple/field_error', errors: item.errors.price_per_month %}
      </fieldset>

    </div>
  </div>

  <fieldset class="mt-6">
    <label class="block" for="location_name">{{ 'app.items.form.location_name' | t }}:</label>
    <input class="w-full" type="text" id="location_name" name="item[location_name]" value="{{ item.location_name }}" >
    {% render 'theme/simple/field_error', errors: item.errors.location_name %}
  </fieldset>

  <fieldset class="mt-6">
    <label class="block" for="location_address">{{ 'app.items.form.location_address' | t }}:</label>
    <input class="w-full" type="text" id="location_address" name="item[location_address]" value="{{ item.location_address }}" >
    {% render 'theme/simple/field_error', errors: item.errors.location_address %}
  </fieldset>

  <fieldset class="mt-6">
    <label class="block" for="zip_code">{{ 'app.items.form.zip_code' | t }}:</label>
    <input class="w-full" type="text" id="zip_code" name="item[zip_code]" value="{{ item.zip_code }}" >
    {% render 'theme/simple/field_error', errors: item.errors.zip_code %}
  </fieldset>

  <fieldset class="mt-6">
    <label class="block" for="location_type">{{ 'app.items.form.location_type' | t }}:</label>
    <select class="w-full" id="location_type" name="item[location_type]">
      <option value="Business" {% if item.location_type == 'Business' %}selected{% endif %}>Business</option>
      <option value="Co-Working" {% if item.location_type == 'Co-Working' %}selected{% endif %}>Co-Working</option>
      <option value="Public" {% if item.location_type == 'Public' %}selected{% endif %}>Public</option>
      <option value="Executive Suites" {% if item.location_type == 'Executive Suites' %}selected{% endif %}>Executive Suites</option>
    </select>
    {% render 'theme/simple/field_error', errors: item.errors.location_type %}
  </fieldset>

  <fieldset class="mt-6">
    <label for="availability">{{ 'app.items.form.availability' | t }}</label>
    <select @change="$event.target.value == 'Customize' ? isShowCusAvailability=true : isShowCusAvailability=false" id="availability" name="item[availability]">
      <option value="Mon to Fri (9:00AM - 6:00PM)" {% if item.availability == 'Mon to Fri (9:00AM - 6:00PM)' %}selected{% endif %}>Mon to Fri (9:00AM - 6:00PM)</option>
      <option value="Customize" {% if item.availability == 'Customize' %}selected{% endif %}>Customize</option>
    </select>
  </fieldset>

  <fieldset class="mt-6">
    <label class="block" for="property_status">{{ 'app.items.form.property_status' | t }}:</label>
    <select class="w-full" id="property_status" name="item[property_status]">
      <option value="active" {% if item.property_status == 'active' %}selected{% endif %}>Active</option>
      <option value="inactive" {% if item.property_status == 'inactive' %}selected{% endif %}>Inactive</option>
    </select>
    {% render 'theme/simple/field_error', errors: item.errors.property_status %}
  </fieldset>

  {% comment %}
    Temporarily hardcoded values, this should be manageable
  {% endcomment %}

  <fieldset class="mt-6">
    <label class="block" for="desk_type">{{ 'app.items.form.desk_type' | t }}:</label>
    <select class="w-full" id="desk_type" name="item[desk_type]">
      <option value="Desk" {% if item.desk_type == 'Desk' %}selected{% endif %}>Desk</option>
      <option value="Meeting Room" {% if item.desk_type == 'Meeting Room' %}selected{% endif %}>Meeting Room</option>
      <option value="Office Space" {% if item.desk_type == 'Office Space' %}selected{% endif %}>Office Space</option>
      <option value="Saloon Booth" {% if item.desk_type == 'Saloon Booth' %}selected{% endif %}>Saloon Booth</option>
      <option value="Events" {% if item.desk_type == 'Events' %}selected{% endif %}>Events</option>
      <option value="Lecture Room" {% if item.desk_type == 'Lecture Room' %}selected{% endif %}>Lecture Room</option>
    </select>
    {% render 'theme/simple/field_error', errors: item.errors.desk_type %}
  </fieldset>

  {% unless item.item_inventory_id %}
    <fieldset class="mt-6">
      <label class="block" for="quantity">{{ 'app.items.form.quantity' | t }}:</label>
      <input class="w-3/4" type="number" id="quantity" name="item[quantity]" value="{{ item.quantity | default: 1 }}" />
      {% render 'theme/simple/field_error', errors: item.errors.quantity %}
    </fieldset>

    <fieldset class="mt-6">
      <label class="block" for="max_in_one_order">{{ 'app.items.form.max_quantity' | t }}:</label>
      <input class="w-3/4" type="number" id="quantity" name="item[max_in_one_order]" value="{{ item.max_in_one_order | default: 5 }}" />
      {% render 'theme/simple/field_error', errors: item.errors.max_in_one_order %}
    </fieldset>
  {% endunless %}

  <fieldset class="mt-6" style="display:none;">
    <label class="block" for="price">{{ 'app.items.form.price' | t }}:</label>
    <!-- TODO: Add currency prefix $[input]  -->
    <div class="flex items-center gap-3">
      <input class="w-3/4" type="number" id="price" name="item[price]" step="any" min="0" value="{{ item.price | default: 1000 | fractional_to_amount: currency }}">
      {{ currency }}
    </div>
    {% render 'theme/simple/field_error', errors: item.errors.price %}
  </fieldset>

  {% comment %}
    <div class="mt-6">
      <label class="block" for="tags">Tags</label>
      <input class="w-full" type="text" id="tags" name="item[tags]" value="{{ item.tags | join: ',' }}" />
      {% if item.errors.tags %}
      <span class="text-danger">{{ item.errors.tags }}</span>
      {% endif %}
    </div>

    <div class="my-6">
      <label class="block" for="sku">{{ 'app.items.form.sku' | t }}</label>
      <input class="w-2/3" type="text" id="sku" name="item[sku]" value="{{ item.sku }}" {% if item.id %}disabled{% endif %}>
      {% render 'theme/simple/field_error', errors: item.errors.sku %}
    </div>
  {% endcomment %}


  <fieldset class="mt-6">
    <label class="block">{{ 'app.items.form.photos' | t }}:</label>
    {% render 'theme/simple/photos/uppy_area' %}
    {% liquid
      assign photo_ids = photos | map: 'id' | join: ','
    %}
    <input type="hidden" name="item[photo_ids]" value="{{photo_ids}}">
  </fieldset>

  <fieldset class="mt-12 text-end">
    <button class="button button-icon-left" value="{{ path }}">
      {% render 'theme/simple/ui/icon', icon: 'check' %}
      {{ 'app.items.form.submit' | t }}
    </button>
  </fieldset>

</form>

{% assign photos = photos | default: item.photos %}
{% render 'theme/simple/photos/uppy_form',
     object_uuid: item_uuid,
     presigned_url: presigned_url,
     user_id: user.id,
     photo_type: 'photo',
     note: 'Images only, up to 3 files, 2MB each',
     max_number_of_files: 3,
     existing_photos: photos
%}
